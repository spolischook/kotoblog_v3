---
author: "Serhii Polishchuk"
title: "Прощай Disqus"
date: 2018-09-02
tags: ["Symfony2"]
draft: false
---
<!--more-->
### Preface 
Лет пять назад по совету моего коллеги мы подключили Disqus к одному из наших пет проектов.
С тех пор сервис стал решением для комментариев by default.
Но сегодня изучая Network панель я заметил странные лишние вызовы...

Оказалось что Disqus рос и со временем стал немалой по мировым меркам рекламной платформой.
И как водится в мире маркетинга они делятся некоторыми своими (на самом деле моими и вашими) данными со своими партнерами.
<img src="https://d2ck16jxw8uc3k.cloudfront.net/Articles/119-bye-bye-disqus/disqus-partners.png" class="img-fluid">

Когдато хороший бесплатный сервис (на самом деле он таким и остался) вырос из детских штанишек и стал большой рекламной платформой и маркетинговой фермой.
Незнаю почему но мне не давал покоя этот кусок JavaScript которой делает на моем сайте что ему вздумается.
### Пилим свои коментарии
Для коментов мне понадобилось:
- FosUserBundle
- FosCommentBundle
- SymfonyAclBundle (в 4.1 вынесли в отдельный пакет)
- HWIOAuthBundle

Много горя пришлось пережить с редиректом на главную после логина. 
Примерно час дебага ушло на то чтобы найти SymfonySecurity::DefaultAuthenticationSuccessHandler и его метод determineTargetUrl.
Оказалось что в hwi_oauth есть конфиг опция которая по дефолту выключена!:

    hwi_oauth:
        use_referer: true

Если ее включить то редирект после логина будет на ту же страницу с которой и логин. Держите, не благодарите.

Рассказывать все приключения которые я встретил за время установки и настройки всего этого барахла не хватит ночи. Достаточно будет сказать что заняло это почти 10 часов.

Отдельного упоминания и нарициния достоин FosCommentBundle (на самом деле по каждому есть что сказать) с его кривыми шаблонами и документацией. Хотя дока почти у всех печальная.

Ну и так как я уже психонул окончательно, на всякий случай заменил все CDN на свой собственный CloudFront. 
Ибо нефиг наживатся на личной инфе меня и моих гостей.
На сим все, теперь пишите комменты.

P.S. скрин результата:
<img src="https://d2ck16jxw8uc3k.cloudfront.net/Articles/119-bye-bye-disqus/comments.png" class="img-fluid">
